flowchart TD
    %% Map Viewing Module
    
    Start([üëÅÔ∏è Map Viewing]) --> LoadMap[üó∫Ô∏è Load Map Interface]
    LoadMap --> MapLoaded{Map Loaded?}
    MapLoaded -->|No| MapError[‚ùå Map Loading Error]
    MapLoaded -->|Yes| MapInterface[üó∫Ô∏è Interactive Map Interface]
    
    MapInterface --> ViewingOptions{Select Viewing Option}
    
    %% Viewing Options
    ViewingOptions --> ViewLocations[üìç View All Locations]
    ViewingOptions --> FilterLocations[üîΩ Filter Locations]
    ViewingOptions --> SearchLocation[üîç Search Location]
    ViewingOptions --> LayerControls[üìã Layer Controls]
    ViewingOptions --> MapNavigation[üß≠ Map Navigation]
    
    %% View All Locations
    ViewLocations --> DisplayMarkers[üìç Display All Markers]
    DisplayMarkers --> MarkerInteraction{Marker Interaction}
    MarkerInteraction --> ViewMarkerDetails[üëÅÔ∏è View Marker Details]
    MarkerInteraction --> EditMarker[‚úèÔ∏è Edit Marker]
    MarkerInteraction --> DeleteMarker[üóëÔ∏è Delete Marker]
    
    ViewMarkerDetails --> MarkerPopup[üìã Marker Information Popup]
    MarkerPopup --> PopupActions{Popup Action}
    PopupActions --> ViewFullDetails[üìÑ View Full Details]
    PopupActions --> GetDirections[üß≠ Get Directions]
    PopupActions --> ShareLocation[üì§ Share Location]
    PopupActions --> ClosePopup[‚ùå Close Popup]
    
    %% Filter Locations
    FilterLocations --> FilterOptions[üîΩ Filter Options Panel]
    FilterOptions --> CategoryFilter[üìÇ Category Filter]
    FilterOptions --> DateFilter[üìÖ Date Filter]
    FilterOptions --> StatusFilter[üîò Status Filter]
    FilterOptions --> RadiusFilter[‚≠ï Radius Filter]
    FilterOptions --> CustomFilter[‚öôÔ∏è Custom Filter]
    
    CategoryFilter --> ApplyFilter[‚úÖ Apply Filters]
    DateFilter --> ApplyFilter
    StatusFilter --> ApplyFilter
    RadiusFilter --> ApplyFilter
    CustomFilter --> ApplyFilter
    
    ApplyFilter --> FilteredResults[üìç Display Filtered Results]
    FilteredResults --> ClearFilters[üßπ Clear Filters]
    ClearFilters --> MapInterface
    
    %% Search Location
    SearchLocation --> SearchInput[üîç Search Input Field]
    SearchInput --> SearchQuery{Enter Search Query}
    SearchQuery --> LocationSearch[üîç Perform Location Search]
    LocationSearch --> SearchResults{Search Results Found?}
    SearchResults -->|No| NoResults[‚ùå No Results Found]
    SearchResults -->|Yes| DisplaySearchResults[üìç Display Search Results]
    
    DisplaySearchResults --> SelectSearchResult[üéØ Select Result]
    SelectSearchResult --> ZoomToLocation[üîç Zoom to Location]
    ZoomToLocation --> HighlightLocation[‚≠ê Highlight Location]
    
    %% Layer Controls
    LayerControls --> LayerPanel[üìã Layer Control Panel]
    LayerPanel --> ToggleLayers{Toggle Layers}
    ToggleLayers --> HealthFacilities[üè• Health Facilities]
    ToggleLayers --> PatientLocations[üë§ Patient Locations]
    ToggleLayers --> EventLocations[üìÖ Event Locations]
    ToggleLayers --> RiskAreas[‚ö†Ô∏è Risk Areas]
    ToggleLayers --> TransportRoutes[üöó Transport Routes]
    
    HealthFacilities --> UpdateMapDisplay[üîÑ Update Map Display]
    PatientLocations --> UpdateMapDisplay
    EventLocations --> UpdateMapDisplay
    RiskAreas --> UpdateMapDisplay
    TransportRoutes --> UpdateMapDisplay
    
    %% Map Navigation
    MapNavigation --> NavigationControls[üß≠ Navigation Controls]
    NavigationControls --> ZoomControls[üîç Zoom Controls]
    NavigationControls --> PanControls[üëÜ Pan Controls]
    NavigationControls --> LocationControls[üìç Location Controls]
    NavigationControls --> ViewControls[üëÅÔ∏è View Controls]
    
    ZoomControls --> ZoomIn[‚ûï Zoom In]
    ZoomControls --> ZoomOut[‚ûñ Zoom Out]
    ZoomControls --> FitBounds[üîÑ Fit All Markers]
    
    PanControls --> PanMap[üëÜ Pan Map]
    LocationControls --> CurrentLocation[üìç Current Location]
    ViewControls --> SatelliteView[üõ∞Ô∏è Satellite View]
    ViewControls --> StreetView[üèòÔ∏è Street View]
    ViewControls --> TerrainView[üóª Terrain View]
    
    %% Return paths
    ViewFullDetails --> MarkerPopup
    GetDirections --> MarkerPopup
    ShareLocation --> MarkerPopup
    ClosePopup --> DisplayMarkers
    EditMarker --> DisplayMarkers
    DeleteMarker --> DisplayMarkers
    FilteredResults --> MapInterface
    NoResults --> SearchInput
    HighlightLocation --> MapInterface
    UpdateMapDisplay --> MapInterface
    ZoomIn --> MapInterface
    ZoomOut --> MapInterface
    FitBounds --> MapInterface
    PanMap --> MapInterface
    CurrentLocation --> MapInterface
    SatelliteView --> MapInterface
    StreetView --> MapInterface
    TerrainView --> MapInterface
    MapError --> Start
    
    %% Back to main dashboard
    MapInterface --> Dashboard[üè† Back to Dashboard]
    
    %% Styling
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef success fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#000
    classDef controls fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000
    
    class Start,Dashboard startEnd
    class LoadMap,MapInterface,ViewLocations,FilterLocations,SearchLocation,LayerControls,MapNavigation,DisplayMarkers,ViewMarkerDetails,EditMarker,DeleteMarker,FilterOptions,SearchInput,LocationSearch,DisplaySearchResults,LayerPanel,NavigationControls process
    class MapLoaded,ViewingOptions,MarkerInteraction,PopupActions,SearchQuery,SearchResults,ToggleLayers decision
    class ApplyFilter,ZoomToLocation,HighlightLocation,UpdateMapDisplay success
    class MapError,NoResults error
    class ZoomControls,PanControls,LocationControls,ViewControls controls
