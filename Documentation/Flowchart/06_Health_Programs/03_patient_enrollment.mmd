flowchart TD
    %% Patient Enrollment Module
    
    Start([üë• Patient Enrollment]) --> EnrollmentDashboard[üìä Enrollment Dashboard]
    EnrollmentDashboard --> EnrollmentActions{Select Action}
    
    %% Main enrollment actions
    EnrollmentActions --> EnrollPatient[‚ûï Enroll Patient]
    EnrollmentActions --> ViewEnrollments[üìã View Enrollments]
    EnrollmentActions --> UpdateEnrollment[‚úèÔ∏è Update Enrollment]
    EnrollmentActions --> TransferPatient[üîÑ Transfer Patient]
    EnrollmentActions --> WithdrawPatient[üö™ Withdraw Patient]
    
    %% Enroll Patient Flow
    EnrollPatient --> SearchPatient[üîç Search Patient]
    SearchPatient --> PatientFound{Patient Found?}
    PatientFound -->|No| CreatePatientRecord[‚ûï Create Patient Record]
    PatientFound -->|Yes| CheckEligibility[‚úÖ Check Eligibility]
    CreatePatientRecord --> CheckEligibility
    
    CheckEligibility --> EligibilityResult{Eligible?}
    EligibilityResult -->|No| EligibilityDenied[‚ùå Eligibility Denied]
    EligibilityResult -->|Yes| SelectProgram[üéØ Select Program]
    
    SelectProgram --> ProgramAvailable{Program Available?}
    ProgramAvailable -->|No| WaitingList[‚è≥ Add to Waiting List]
    ProgramAvailable -->|Yes| EnrollmentForm[üìù Fill Enrollment Form]
    
    EnrollmentForm --> ConsentProcess[üìã Consent Process]
    ConsentProcess --> ConsentGiven{Consent Given?}
    ConsentGiven -->|No| EnrollmentCancelled[‚ùå Enrollment Cancelled]
    ConsentGiven -->|Yes| AssignBaseline[üìä Assign Baseline Assessment]
    AssignBaseline --> ScheduleOrientation[üìÖ Schedule Orientation]
    ScheduleOrientation --> CompleteEnrollment[‚úÖ Complete Enrollment]
    
    %% View Enrollments Flow
    ViewEnrollments --> FilterEnrollments[üîΩ Filter Options]
    FilterEnrollments --> DisplayEnrollments[üìã Display Enrollments]
    DisplayEnrollments --> EnrollmentDetails[üëÅÔ∏è View Details]
    
    %% Update Enrollment Flow
    UpdateEnrollment --> SelectEnrollment[üéØ Select Enrollment]
    SelectEnrollment --> UpdateForm[üìù Update Form]
    UpdateForm --> ValidateUpdate{Valid Update?}
    ValidateUpdate -->|No| UpdateForm
    ValidateUpdate -->|Yes| SaveEnrollmentUpdate[üíæ Save Update]
    SaveEnrollmentUpdate --> EnrollmentUpdated[‚úÖ Enrollment Updated]
    
    %% Transfer Patient Flow
    TransferPatient --> SelectTransferPatient[üéØ Select Patient]
    SelectTransferPatient --> SelectTargetProgram[üéØ Select Target Program]
    SelectTargetProgram --> ValidateTransfer{Valid Transfer?}
    ValidateTransfer -->|No| SelectTargetProgram
    ValidateTransfer -->|Yes| CompleteTransfer[üîÑ Complete Transfer]
    CompleteTransfer --> TransferCompleted[‚úÖ Transfer Completed]
    
    %% Withdraw Patient Flow
    WithdrawPatient --> SelectWithdrawPatient[üéØ Select Patient]
    SelectWithdrawPatient --> WithdrawReason[üìù Withdrawal Reason]
    WithdrawReason --> ConfirmWithdrawal{Confirm Withdrawal?}
    ConfirmWithdrawal -->|No| EnrollmentDashboard
    ConfirmWithdrawal -->|Yes| ProcessWithdrawal[üö™ Process Withdrawal]
    ProcessWithdrawal --> WithdrawalCompleted[‚úÖ Withdrawal Completed]
    
    %% Return paths
    CompleteEnrollment --> EnrollmentDashboard
    EnrollmentDetails --> DisplayEnrollments
    EnrollmentUpdated --> EnrollmentDashboard
    TransferCompleted --> EnrollmentDashboard
    WithdrawalCompleted --> EnrollmentDashboard
    EligibilityDenied --> EnrollmentDashboard
    EnrollmentCancelled --> EnrollmentDashboard
    WaitingList --> EnrollmentDashboard
    
    %% Back to main dashboard
    EnrollmentDashboard --> Dashboard[üè† Back to Dashboard]
    
    %% Styling
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef success fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#000
    classDef form fill:#f1f8e9,stroke:#33691e,stroke-width:2px,color:#000
    
    class Start,Dashboard startEnd
    class EnrollmentDashboard,EnrollPatient,ViewEnrollments,UpdateEnrollment,TransferPatient,WithdrawPatient,SearchPatient,CheckEligibility,SelectProgram,ConsentProcess,AssignBaseline,ScheduleOrientation,FilterEnrollments,DisplayEnrollments,UpdateForm,SaveEnrollmentUpdate,SelectTransferPatient,SelectTargetProgram,CompleteTransfer,SelectWithdrawPatient,ProcessWithdrawal process
    class EnrollmentActions,PatientFound,EligibilityResult,ProgramAvailable,ConsentGiven,ValidateUpdate,ValidateTransfer,ConfirmWithdrawal decision
    class CompleteEnrollment,EnrollmentUpdated,TransferCompleted,WithdrawalCompleted success
    class EligibilityDenied,EnrollmentCancelled error
    class EnrollmentForm,WithdrawReason form
